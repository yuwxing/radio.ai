<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio.AI - æ²»æ„ˆç³»AIè¯­éŸ³ç”µå°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

        :root {
            --soft-blue: #a7c5eb;
            --soft-purple: #c9a7eb;
            --soft-pink: #f3c1e1;
            --soft-green: #b8eacb;
            --soft-yellow: #f0e68c;
            --light-beige: #f9f5eb;
            --warm-white: #fffdf8;
            --soft-gray: #e0d8d0;
            --muted-teal: #a3c4bc;
            --healing-shadow: 0 4px 20px rgba(167, 197, 235, 0.3);
            --healing-shadow-alt: 0 4px 15px rgba(201, 167, 235, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--light-beige) 0%, var(--warm-white) 100%);
            min-height: 100vh;
            color: #5a5a5a;
            line-height: 1.6;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(167, 197, 235, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(201, 167, 235, 0.1) 0%, transparent 20%);
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 253, 248, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 35px;
            box-shadow: var(--healing-shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 2px solid var(--soft-blue);
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--soft-purple);
        }

        .logo {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--soft-blue), var(--soft-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tagline {
            color: #8a8a8a;
            font-size: 1.1em;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            gap: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--healing-shadow-alt);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(167, 197, 235, 0.4);
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #4a4a4a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-controls {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .voice-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .voice-option {
            padding: 8px 16px;
            border: 2px solid var(--soft-blue);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .voice-option:hover {
            background: var(--soft-blue);
            color: white;
        }

        .voice-option.selected {
            background: var(--soft-purple);
            border-color: var(--soft-purple);
            color: white;
        }

        .text-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid var(--soft-gray);
            border-radius: 15px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--soft-purple);
            box-shadow: 0 0 0 3px rgba(201, 167, 235, 0.2);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--soft-blue), var(--soft-purple));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(167, 197, 235, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            color: #6a6a6a;
            border: 2px solid var(--soft-gray);
        }

        .btn-secondary:hover {
            background: var(--soft-gray);
            color: white;
        }

        .audio-player {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .play-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--soft-green), var(--muted-teal));
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            transform: scale(1.1);
        }

        .track-info {
            flex: 1;
        }

        .track-title {
            font-weight: 600;
            color: #4a4a4a;
        }

        .track-artist {
            font-size: 0.9em;
            color: #8a8a8a;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--soft-gray);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--soft-green), var(--muted-teal));
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: 500;
        }

        .status-success {
            background: rgba(184, 234, 203, 0.8);
            color: #2d7a4e;
        }

        .status-error {
            background: rgba(243, 193, 225, 0.8);
            color: #a14467;
        }

        .status-info {
            background: rgba(167, 197, 235, 0.8);
            color: #2d5a8e;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quick-action {
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            border-color: var(--soft-purple);
            transform: translateY(-2px);
        }

        .quick-action-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .quick-action-title {
            font-weight: 600;
            color: #4a4a4a;
        }

        .quick-action-desc {
            font-size: 0.9em;
            color: #8a8a8a;
            margin-top: 5px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .voice-selector {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">ğŸµ Radio.AI</div>
            <div class="tagline">æ²»æ„ˆç³»AIè¯­éŸ³ç”µå° - ç”¨å£°éŸ³æ¸©æš–å¿ƒçµ</div>
        </header>

        <main class="main-content">
            <!-- AIè¯­éŸ³ç”Ÿæˆå™¨éƒ¨åˆ† -->
            <section class="section">
                <h2 class="section-title">
                    <span>ğŸ¤</span>
                    <span>AIè¯­éŸ³ç”Ÿæˆå™¨</span>
                </h2>
                
                <div class="voice-controls">
                    <div class="voice-selector" id="voiceSelector">
                        <div class="voice-option selected" data-voice="female1">æ¸©æŸ”å¥³å£°</div>
                        <div class="voice-option" data-voice="male1">æ¸©æš–ç”·å£°</div>
                        <div class="voice-option" data-voice="female2">æ¸…æ–°å¥³å£°</div>
                        <div class="voice-option" data-voice="male2">èˆ’ç¼“ç”·å£°</div>
                    </div>
                    
                    <textarea 
                        id="textInput" 
                        class="text-input" 
                        placeholder="è¯·è¾“å…¥æ‚¨æƒ³è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡å­—å†…å®¹...&#10;&#10;ä¾‹å¦‚ï¼š&#10;â€¢ æ’­æ”¾ä¸€é¦–è½»æ¾çš„éŸ³ä¹&#10;â€¢ è®²ä¸€ä¸ªæ¸©é¦¨çš„ç¡å‰æ•…äº‹&#10;â€¢ ä»‹ç»ä¸€ä¸‹ä»Šå¤©çš„æ–°é—»&#10;â€¢ å”±ä¸€é¦–ã€Šæœˆäº®ä»£è¡¨æˆ‘çš„å¿ƒã€‹"
                    ></textarea>
                    
                    <div class="button-group">
                        <button id="generateBtn" class="btn btn-primary">
                            <span>ğŸ¤</span>
                            <span>ç”Ÿæˆè¯­éŸ³</span>
                        </button>
                        <button id="clearBtn" class="btn btn-secondary">
                            <span>ğŸ—‘ï¸</span>
                            <span>æ¸…ç©ºå†…å®¹</span>
                        </button>
                    </div>
                </div>

                <div id="statusMessage" class="status-message" style="display: none;"></div>
            </section>

            <!-- éŸ³é¢‘æ’­æ”¾å™¨éƒ¨åˆ† -->
            <section class="section">
                <h2 class="section-title">
                    <span>ğŸ§</span>
                    <span>éŸ³é¢‘æ’­æ”¾å™¨</span>
                </h2>
                
                <div class="audio-player">
                    <div class="player-controls">
                        <button id="playBtn" class="play-btn">â–¶ï¸</button>
                        <div class="track-info">
                            <div class="track-title" id="trackTitle">ç­‰å¾…æ’­æ”¾...</div>
                            <div class="track-artist" id="trackArtist">Radio.AI</div>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="progressBar"></div>
                    </div>
                    
                    <div class="button-group">
                        <button id="pauseBtn" class="btn btn-secondary">
                            <span>â¸ï¸</span>
                            <span>æš‚åœ</span>
                        </button>
                        <button id="stopBtn" class="btn btn-secondary">
                            <span>â¹ï¸</span>
                            <span>åœæ­¢</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- å¿«é€Ÿæ“ä½œéƒ¨åˆ† -->
            <section class="section">
                <h2 class="section-title">
                    <span>âš¡</span>
                    <span>å¿«é€Ÿæ“ä½œ</span>
                </h2>
                
                <div class="quick-actions">
                    <div class="quick-action" data-action="music">
                        <div class="quick-action-icon">ğŸµ</div>
                        <div class="quick-action-title">æ’­æ”¾éŸ³ä¹</div>
                        <div class="quick-action-desc">è½»æ¾èˆ’ç¼“çš„éŸ³ä¹</div>
                    </div>
                    
                    <div class="quick-action" data-action="news">
                        <div class="quick-action-icon">ğŸ“°</div>
                        <div class="quick-action-title">æ–°é—»èµ„è®¯</div>
                        <div class="quick-action-desc">æœ€æ–°æ–°é—»æ’­æŠ¥</div>
                    </div>
                    
                    <div class="quick-action" data-action="story">
                        <div class="quick-action-icon">ğŸ“–</div>
                        <div class="quick-action-title">ç¡å‰æ•…äº‹</div>
                        <div class="quick-action-desc">æ¸©é¦¨ç¡å‰æ•…äº‹</div>
                    </div>
                    
                    <div class="quick-action" data-action="comedy">
                        <div class="quick-action-icon">ğŸ˜„</div>
                        <div class="quick-action-title">ç›¸å£°è¯„ä¹¦</div>
                        <div class="quick-action-desc">è½»æ¾å¹½é»˜å†…å®¹</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ä¿®å¤ç‰ˆè„šæœ¬ -->
    <script src="ai-voice-generator-fixed.js"></script>
    <script src="audio-manager-fixed.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let voiceGenerator = null;
        let audioManager = null;
        let currentAudioUrl = null;

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // åˆå§‹åŒ–è¯­éŸ³ç”Ÿæˆå™¨å’ŒéŸ³é¢‘ç®¡ç†å™¨
                voiceGenerator = new AIVoiceGenerator();
                audioManager = new AudioManager();
                
                console.log('Radio.AI åˆå§‹åŒ–å®Œæˆ');
                updateStatus('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œæ¬¢è¿ä½¿ç”¨Radio.AIæ²»æ„ˆç³»è¯­éŸ³ç”µå°ï¼', 'success');
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
                initEventListeners();
                
                // åˆå§‹åŒ–è¯­éŸ³é€‰æ‹©
                initVoiceSelection();
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                updateStatus('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        });

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // ç”Ÿæˆè¯­éŸ³æŒ‰é’®
            document.getElementById('generateBtn').addEventListener('click', handleGenerateVoice);
            
            // æ¸…ç©ºæŒ‰é’®
            document.getElementById('clearBtn').addEventListener('click', handleClear);
            
            // æ’­æ”¾æ§åˆ¶æŒ‰é’®
            document.getElementById('playBtn').addEventListener('click', handlePlay);
            document.getElementById('pauseBtn').addEventListener('click', handlePause);
            document.getElementById('stopBtn').addEventListener('click', handleStop);
            
            // å¿«é€Ÿæ“ä½œæŒ‰é’®
            document.querySelectorAll('.quick-action').forEach(btn => {
                btn.addEventListener('click', handleQuickAction);
            });
            
            // æ–‡æœ¬è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            document.getElementById('textInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleGenerateVoice();
                }
            });
        }

        // åˆå§‹åŒ–è¯­éŸ³é€‰æ‹©
        function initVoiceSelection() {
            const voiceOptions = document.querySelectorAll('.voice-option');
            voiceOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
                    voiceOptions.forEach(opt => opt.classList.remove('selected'));
                    // æ·»åŠ é€‰ä¸­çŠ¶æ€
                    this.classList.add('selected');
                    // è®¾ç½®è¯­éŸ³
                    const voiceId = this.getAttribute('data-voice');
                    if (voiceGenerator) {
                        voiceGenerator.setVoice(voiceId);
                    }
                });
            });
        }

        // å¤„ç†ç”Ÿæˆè¯­éŸ³
        async function handleGenerateVoice() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            
            if (!text) {
                updateStatus('è¯·è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡å­—å†…å®¹', 'error');
                return;
            }
            
            if (!voiceGenerator) {
                updateStatus('è¯­éŸ³ç”Ÿæˆå™¨æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                return;
            }
            
            try {
                updateStatus('æ­£åœ¨ç”Ÿæˆè¯­éŸ³ï¼Œè¯·ç¨å€™...', 'info');
                
                // ç”Ÿæˆè¯­éŸ³
                const result = await voiceGenerator.generateSpeech(text);
                
                if (result.success) {
                    currentAudioUrl = result.audioUrl;
                    updateStatus('è¯­éŸ³ç”ŸæˆæˆåŠŸï¼ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ”¶å¬', 'success');
                    
                    // æ›´æ–°æ’­æ”¾å™¨ä¿¡æ¯
                    updateTrackInfo('AIç”Ÿæˆè¯­éŸ³', `${voiceGenerator.getVoiceName(voiceGenerator.selectedVoice)} - ${result.duration}`);
                    
                    // è‡ªåŠ¨æ’­æ”¾
                    setTimeout(() => {
                        handlePlay();
                    }, 1000);
                }
                
            } catch (error) {
                console.error('ç”Ÿæˆè¯­éŸ³å¤±è´¥:', error);
                updateStatus('è¯­éŸ³ç”Ÿæˆå¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // å¤„ç†æ¸…ç©º
        function handleClear() {
            document.getElementById('textInput').value = '';
            currentAudioUrl = null;
            updateStatus('å†…å®¹å·²æ¸…ç©º', 'info');
        }

        // å¤„ç†æ’­æ”¾
        async function handlePlay() {
            if (!currentAudioUrl) {
                updateStatus('è¯·å…ˆç”Ÿæˆè¯­éŸ³å†…å®¹', 'error');
                return;
            }
            
            if (!audioManager) {
                updateStatus('éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const success = await audioManager.playAudio(currentAudioUrl, 'AIç”Ÿæˆè¯­éŸ³');
                if (success) {
                    updateStatus('æ­£åœ¨æ’­æ”¾...', 'success');
                    updatePlayButton(true);
                }
            } catch (error) {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                updateStatus('æ’­æ”¾å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // å¤„ç†æš‚åœ
        function handlePause() {
            if (audioManager) {
                audioManager.pauseAudio();
                updateStatus('å·²æš‚åœ', 'info');
                updatePlayButton(false);
            }
        }

        // å¤„ç†åœæ­¢
        function handleStop() {
            if (audioManager) {
                audioManager.stopAudio();
                updateStatus('å·²åœæ­¢', 'info');
                updatePlayButton(false);
                updateTrackInfo('ç­‰å¾…æ’­æ”¾...', 'Radio.AI');
            }
        }

        // å¤„ç†å¿«é€Ÿæ“ä½œ
        async function handleQuickAction(e) {
            const action = e.currentTarget.getAttribute('data-action');
            const textInput = document.getElementById('textInput');
            
            // æ ¹æ®æ“ä½œç±»å‹è®¾ç½®é¢„è®¾æ–‡æœ¬
            const presetTexts = {
                music: 'è¯·æ’­æ”¾ä¸€é¦–è½»æ¾èˆ’ç¼“çš„éŸ³ä¹ï¼Œå¸®åŠ©æˆ‘æ”¾æ¾å¿ƒæƒ…',
                news: 'è¯·ä¸ºæˆ‘æ’­æŠ¥ä»Šå¤©çš„æœ€æ–°æ–°é—»èµ„è®¯',
                story: 'è¯·è®²ä¸€ä¸ªæ¸©é¦¨çš„ç¡å‰æ•…äº‹ï¼Œå¸®åŠ©æˆ‘å®‰ç„¶å…¥ç¡',
                comedy: 'è¯·æ’­æ”¾ä¸€æ®µæœ‰è¶£çš„ç›¸å£°æˆ–è¯„ä¹¦ï¼Œè®©æˆ‘å¼€å¿ƒä¸€ä¸‹'
            };
            
            if (presetTexts[action]) {
                textInput.value = presetTexts[action];
                updateStatus(`å·²è®¾ç½®${e.currentTarget.querySelector('.quick-action-title').textContent}çš„è¯·æ±‚å†…å®¹`, 'info');
                
                // è‡ªåŠ¨ç”Ÿæˆè¯­éŸ³
                setTimeout(() => {
                    handleGenerateVoice();
                }, 500);
            }
        }

        // æ›´æ–°çŠ¶æ€ä¿¡æ¯
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';
            
            // è‡ªåŠ¨éšè—æˆåŠŸå’Œä¿¡æ¯æ¶ˆæ¯
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);
            }
        }

        // æ›´æ–°æ›²ç›®ä¿¡æ¯
        function updateTrackInfo(title, artist) {
            document.getElementById('trackTitle').textContent = title;
            document.getElementById('trackArtist').textContent = artist;
        }

        // æ›´æ–°æ’­æ”¾æŒ‰é’®çŠ¶æ€
        function updatePlayButton(isPlaying) {
            const playBtn = document.getElementById('playBtn');
            playBtn.textContent = isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
        }

        // é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e.error);
            updateStatus('ç³»ç»Ÿå‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', function() {
            if (audioManager) {
                audioManager.cleanup();
            }
        });
    </script>
</body>
</html>